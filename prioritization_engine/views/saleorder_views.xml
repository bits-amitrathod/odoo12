<odoo>
    <data>
        <record id="view_order_form_ex3" model="ir.ui.view">
            <field name="name">sale.order.form_ex</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">

                <button name="action_quotation_send" position="after">
                    <button name="action_quotation_send" string="Send by Email" type="object" states="engine"
                            class="btn-primary"/>
                    <button name="print_quotation" string="Print" type="object"
                            class="btn-primary o_sale_print"/>
                    <button name="action_confirm" id="action_confirm"
                            string="Confirm Sale" class="btn-primary" type="object"
                            attrs="{'invisible': [('state', 'not in', ['engine'])]}"/>
                    <button name="action_cancel" states="engine" type="object" string="Cancel"/>
<!--                    <button string="Shipping Update"-->
<!--                                type="object" class="btn-primary" name="action_fedex_track_request"/>-->

                </button>
                <button name="action_cancel" position="after">
                    <button name="action_void" string="Voided" type="object" states="draft,sent"/>

                </button>

                <xpath expr="//field[@name='validity_date']" position="replace">
                    <field name="validity_date" string="Validity" attrs="{'invisible': [('state', 'in', ['sale', 'done'])]}"/>
                </xpath>

                <field name="partner_shipping_id" position="after">
                    <field name="preferred_method"/>
                    <field name="shipping_terms"/>
                </field>
                <field name="payment_term_id" position="after">
                    <field name="carrier_info"/>
                    <field name="carrier_acc_no"/>
                    <field name="client_order_ref"/>
                    <field name="x_studio_allow_duplicate_po" widget="boolean_toggle"/>
                    <field name="gl_account"/>
                    <field name="is_share"/>
                    <field name="sale_margine"/>
                    <field name="carrier_id" context="{'order_id': id}" options='{"no_open": True, "no_create": True}'/>
                </field>
                <xpath expr="/form/sheet/notebook/page[1]/field[@name='order_line']/tree/field[@name='product_id']"
                       position="after">
                        <field name="req_no"/>
                </xpath>

                <!-- Below line is commented because sales quotation Add a section Add a note are not displaying in odoo12 -->
<!--                 <xpath expr="/form/sheet/notebook/page[1]/field[@name='order_line']/tree/field[@name='name']"-->
<!--                       position="attributes">-->
                     <!-- For Hiding description column -->
<!--                           <attribute name="invisible">True</attribute>-->
<!--                </xpath>-->
                  <xpath expr="/form/sheet/notebook/page[1]/field[@name='order_line']/tree/field[@name='product_id']"
                       position="before">
                        <!-- Adding SKU column -->
                        <field name="default_code"/>
                </xpath>
                <xpath expr="/form/sheet/notebook/page[1]/field[@name='order_line']/tree/field[@name='product_uom']"
                       position="after">
                        <!-- Adding manufacturer_uom column -->
                        <field name="manufacturer_uom"/>
                </xpath>

                <xpath expr="//group[@name='sales_person']/field[@name='user_id']"  position="after">
                     <field name="order_processor"/>
                </xpath>
                <xpath expr="//group[@name='sales_person']/field[@name='client_order_ref']"  position="replace">
                     <field name="client_order_ref" invisible="1"/>
                </xpath>
            </field>
        </record>
      <!--  <record id="view_invoice_form_ex" model="ir.ui.view">
            <field name="name">account.invoice.form_ex</field>
            <field name="model">account.invoice</field>
            <field name="inherit_id" ref="account.invoice_form"/>
            <field name="arch" type="xml">
                <field name="payment_term_id" position="after">
                    <field name="preferred_method"/>
                    <field name="shipping_terms"/>
                </field>
                <field name="date_due" position="after">
                    <field name="sale_margine"/>
                    <field name="expiration_date"/>
                </field>
                <field name="comment" position="before">
                    <field name="note" class="oe_inline" placeholder="Customer Message....."
                           style="width:50% !important;"/>
                    <div class="oe_clear"/>
                </field>
                <xpath expr="/form/sheet[1]/notebook/page[@name='other_info']/group/group[2]/field[@name='origin']"
                       position="replace">
                      <field name="origin" string="Order#" groups="base.group_user" attrs="{'invisible': True}"/>
                </xpath>
                <xpath expr="//form/sheet/group/group[2]/div" position="after">
                    <field name="purchase_order" string="Purchase Order#"/>
                    <field name="origin" string="Sale Order#" groups="base.group_user" attrs="{'invisible': [('origin', '=', False)]}"/>
                </xpath>
                <xpath expr="//form/sheet/notebook/page[@name='other_info']/group/group[1]/field[@name='name']"
                       position="replace">
                    <field name="memo"/>
                </xpath>
            </field>
        </record>-->

        <!--<record id="invoice_supplier_form_ex" model="ir.ui.view">
            <field name="name">account.invoice.supplier.form_ex</field>
            <field name="model">account.invoice</field>
            <field name="inherit_id" ref="account.invoice_supplier_form"/>
            <field name="arch" type="xml">
                <field name="origin" position="replace">
                    <field name="origin" string="Purchase Order#" attrs="{'invisible': [('origin', '=', False)]}"/>
                    <field name="name" string="Sale Order#"/>
                </field>
                &lt;!&ndash;remove field&ndash;&gt;
                <xpath expr="/form/sheet[1]/notebook/page[@name='other_info']/group/group[1]/field[@name='name']"
                       position="replace"/>
                <xpath expr="/form/sheet[1]/notebook/page[@name='other_info']/group/group[1]/field[@name='date']"
                       position="after">
                    <field name="memo"/>
                </xpath>
            </field>
        </record>-->

        <record id="view_order_list_cstm" model="ir.ui.view">
            <field name="name">sale.order.list.cstm</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_tree"/>
            <field name="arch" type="xml">
            <xpath expr="//field[@name='user_id']" position="after">
                <field name="is_share"/>
                <field name="sale_margine"/>
            </xpath>
            </field>
        </record>

        <record id="view_order_quotation_tree_cstm" model="ir.ui.view">
            <field name="name">sale.order.quotation.tree.cstm</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_quotation_tree"/>
            <field name="arch" type="xml">
            <xpath expr="//field[@name='user_id']" position="after">
                 <field name="is_share"/>
                <field name="sale_margine"/>
            </xpath>
            </field>
        </record>

        <record id="view_order_form_inherit_sale_stock" model="ir.ui.view">
            <field name="name">sale.order.form.sale.stock</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='order_line']/form/group/group/div/field[@name='product_uom']" position="replace">
                    <field name="product_uom" groups="uom.group_uom" class="oe_inline oe_no_button"
                                                    attrs="{'readonly': [('state', 'in', ('sale','done', 'cancel'))]}" options="{'no_create_edit': True, 'no_open': True}"/>
                </xpath>
            </field>
        </record>

        <!-- Adding Sales Level & Is_shared field into group by-->
        <!--<record id="view_sales_order_filter_inherit" model="ir.ui.view">
            <field name="name">sale.order.common.search.inherit</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.sale_order_view_search_inherit_sale"/>
            <field name="arch" type="xml">
		    <xpath expr="/search/group" position="after">
		        <filter name="sales_level" string="Sales Level" domain="[]" context="{'group_by':'sale_margine'}"/>
                <filter name="is_shared" string="Is Shared" domain="[]" context="{'group_by':'is_share'}"/>
		    </xpath>
            </field>
        </record>-->

    </data>

    <template id="inherit_report_saleorder_document" inherit_id="sale.report_saleorder_document">

        <xpath expr="//h2" position="before">
            <br/>
        </xpath>

        <xpath expr="//div[@id='informations']" position="replace">
            <div class="row mt32 mb32" id="informations">
                <div t-if="doc.client_order_ref" class="col-auto col-3 mw-100 mb-2">
                    <strong>Your Reference:</strong>
                    <p class="m-0" t-field="doc.client_order_ref"/>
                </div>
                <div t-if="doc.date_order and doc.state not in ['draft','sent']" class="col-auto col-3 mw-100 mb-2">
                    <strong>Order Date:</strong>
                    <p class="m-0" t-field="doc.date_order"/>
                </div>
                <div t-if="doc.date_order and doc.state in ['draft','sent']" class="col-auto col-3 mw-100 mb-2">
                    <strong>Quotation Date:</strong>
                    <p class="m-0" t-field="doc.date_order" t-options='{"widget": "date"}'/>
                </div>
                <div t-if="doc.order_processor.name" class="col-auto col-3 mw-100 mb-2">
                    <strong>Order Processor:</strong>
                    <p t-field="doc.order_processor"/>
                </div>
                <div t-if="doc.partner_id.gl_account" class="col-auto col-3 mw-100 mb-2">
                    <strong>GL Account:</strong>
                    <t t-foreach="doc.partner_id.gl_account" t-as="gl_account">
                        <p t-field="gl_account.name"/>
                    </t>
                </div>
                <div name="payment_term" t-if="doc.payment_term_id" class="col-auto col-3 mw-100 mb-2">
                    <strong>Payment Terms:</strong>
                    <p t-field="doc.payment_term_id"/>
                </div>
                <div t-if="doc.validity_date and doc.state in ['draft', 'sent']" class="col-auto col-3 mw-100 mb-2" name="expiration_date">
                    <strong>Expiration Date:</strong>
                    <p class="m-0" t-field="doc.validity_date"/>
                </div>
                <div t-if="doc.user_id.name" class="col-auto col-3 mw-100 mb-2">
                    <strong>Business Development:</strong>
                    <p class="m-0" t-field="doc.user_id"/>
                </div>
                <div t-if="doc.carrier_track_ref" class="col-auto col-3 mw-100 mb-2">
                    <strong>Tracking Reference:</strong>
                    <p t-field="doc.carrier_track_ref"/>
                </div>
                <div t-if="doc.carrier_id " class="col-auto col-3 mw-100 mb-2">
                    <strong>Delivery Method:</strong>
                    <p t-field="doc.carrier_id.name"/>
                </div>
            </div>
        </xpath>

        <xpath expr="//table[@class='table table-sm o_main_table']" position="replace">
            <table class="table table-condensed">
                    <thead>
                        <tr>
                            <th t-if="any([line.order_id.team_id.team_type=='engine' for line in doc.order_line])">Ref #</th>
                            <th>Description</th>
                            <th t-if="any([line.order_id.team_id.team_type=='engine' for line in doc.order_line])">Expiration</th>
                            <th t-if="any([line.req_date for line in doc.order_line])">Requisition Date</th>
                            <th t-if="any([line.req_no for line in doc.order_line])">Requisition No</th>
                            <th t-if="any([line.vendor for line in doc.order_line])">Vendor</th>
                            <th t-if="any([line.item_no for line in doc.order_line])">Item No.</th>
                            <th t-if="any([line.deliver_to_location for line in doc.order_line])">Deliver-to Location</th>
                            <th class="text-right">Quantity</th>
                            <th class="text-right">Unit Price</th>
                            <th t-if="display_discount" class="text-right" groups="sale.group_discount_per_so_line">Disc.(%)</th>
                            <th class="text-right">Taxes</th>
                            <th class="text-right" >Amount</th>
                            <th class="text-right price_tax_included" >Total Price</th>
                        </tr>
                   </thead>
                    <tbody class="sale_tbody">
                         <t t-set="current_subtotal" t-value="0"/>
                         <t t-foreach="doc.order_line" t-as="line">
                             <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                             <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>

                             <tr t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''" style="page-break-inside: avoid">
                                <t t-if="not line.display_type">
                                    <td t-if="line.order_id.team_id.team_type=='engine'"><span t-field="line.product_id.product_tmpl_id.sku_code"/></td>
                                    <td><span t-field="line.name"/></td>
                                    <td t-if="line.order_id.team_id.team_type=='engine'"><span t-field="line.product_min_max_exp_date"/></td>
                                    <td t-if="line.req_date"><span t-field="line.req_date" t-options='{"widget": "date"}'/></td>
                                    <td t-if="line.req_no"><span t-field="line.req_no"/></td>
                                    <td t-if="line.vendor"><span t-field="line.vendor"/></td>
                                    <td t-if="line.item_no"><span t-field="line.item_no"/></td>
                                    <td t-if="line.deliver_to_location"><span t-field="line.deliver_to_location"/></td>
                                    <td class="text-right">
                                        <span t-field="line.product_uom_qty"/>
                                        <span t-field="line.product_uom" groups="product.group_uom"/>
                                    </td>
                                    <td class="text-right">
                                        <span t-field="line.price_unit"/>
                                    </td>
                                    <td t-if="display_discount" class="text-right" groups="sale.group_discount_per_so_line">
                                        <span t-field="line.discount"/>
                                    </td>
                                    <td class="text-right">
                                        <span t-esc="', '.join(map(lambda x: (x.description or x.name), line.tax_id))"/>
                                    </td>
                                    <td class="text-right">
                                        <span t-field="line.price_subtotal"
                                            t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                    </td>
                                    <td class="text-right" >
                                        <span t-field="line.price_total"
                                            t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                    </td>
                                    <span t-field="line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                </t>
                                <t t-if="line.display_type == 'line_section'">
                                    <td colspan="99">
                                        <span t-field="line.name"/>
                                    </td>
                                    <t t-set="current_section" t-value="line"/>
                                    <t t-set="current_subtotal" t-value="0"/>
                                </t>
                                <t t-if="line.display_type == 'line_note'">
                                    <td colspan="99">
                                        <span t-field="line.name"/>
                                    </td>
                                </t>
                            </tr>

                             <t t-if="current_section and (line_last or doc.order_line[line_index+1].display_type == 'line_section')">
                                    <tr class="is-subtotal text-right">
                                        <td colspan="99">
                                            <strong class="mr16">Subtotal</strong>
                                            <span
                                                t-esc="current_subtotal"
                                                t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'
                                            />
                                        </td>
                                    </tr>
                                </t>
                         </t>
                    </tbody>
            </table>
        </xpath>
    </template>

        <template id="inherit_report_purchaseorder_document" inherit_id="purchase.report_purchaseorder_document">
           <xpath expr="//div[@class='page']/div[1]" position="after">
               <br/>
           </xpath>
        </template>
</odoo>
