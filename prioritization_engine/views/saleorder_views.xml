<odoo>
    <data>
        <record id="view_order_form_ex" model="ir.ui.view">
            <field name="name">sale.order.form_ex</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">

                <button name="action_quotation_send" position="after">
                    <button name="action_quotation_send" string="Send by Email" type="object" states="engine"
                            class="btn-primary"/>
                    <button name="print_quotation" string="Print" type="object" states="engine"
                            class="btn-primary o_sale_print"/>
                    <button name="action_confirm" id="action_confirm"
                            string="Confirm Sale" class="btn-primary" type="object"
                            attrs="{'invisible': [('state', 'not in', ['engine'])]}"/>
                    <button name="action_cancel" states="engine" type="object" string="Cancel"/>
<!--                    <button string="Shipping Update"-->
<!--                                type="object" class="btn-primary" name="action_fedex_track_request"/>-->

                </button>
                <button name="action_cancel" position="after">
                    <button name="action_void" string="Voided" type="object" states="draft,sent"/>

                </button>

                <field name="partner_shipping_id" position="after">
                    <field name="preferred_method"/>
                    <field name="shipping_terms"/>
                </field>
                <field name="payment_term_id" position="after">
                    <field name="carrier_info"/>
                    <field name="carrier_acc_no"/>
                    <field name="is_share"/>
                    <field name="sale_margine"/>
                </field>
                <xpath expr="/form/sheet/notebook/page[1]/field[@name='order_line']/tree/field[@name='product_id']"
                       position="after">
                        <field name="req_no"/>
                </xpath>
                 <xpath expr="/form/sheet/notebook/page[1]/field[@name='order_line']/tree/field[@name='name']"
                       position="attributes">
                     <!-- For Hiding description column -->
                           <attribute name="invisible">True</attribute>
                </xpath>
                  <xpath expr="/form/sheet/notebook/page[1]/field[@name='order_line']/tree/field[@name='product_id']"
                       position="before">
                        <!-- Adding SKU column -->
                        <field name="default_code"/>
                </xpath>
                <xpath expr="/form/sheet/notebook/page[1]/field[@name='order_line']/tree/field[@name='product_uom']"
                       position="after">
                        <!-- Adding manufacturer_uom column -->
                        <field name="manufacturer_uom"/>
                </xpath>

                <xpath expr="//group[@name='sales_person']/field[@name='user_id']"  position="after">
                     <field name="order_processor"/>
                </xpath>
            </field>
        </record>
        <record id="view_invoice_form_ex" model="ir.ui.view">
            <field name="name">account.invoice.form_ex</field>
            <field name="model">account.invoice</field>
            <field name="inherit_id" ref="account.invoice_form"/>
            <field name="arch" type="xml">
                <field name="payment_term_id" position="after">
                    <field name="preferred_method"/>
                    <field name="shipping_terms"/>
                </field>
                <field name="date_due" position="after">
                    <field name="sale_margine"/>
                    <field name="expiration_date"/>
                </field>
                <field name="comment" position="before">
                    <field name="note" class="oe_inline" placeholder="Customer Message....."
                           style="width:50% !important;"/>
                    <div class="oe_clear"/>
                </field>
                <xpath expr="/form/sheet[1]/notebook/page[@name='other_info']/group/group[2]/field[@name='origin']"
                       position="replace">
                      <field name="origin" string="Order#" groups="base.group_user" attrs="{'invisible': True}"/>
                </xpath>
                <xpath expr="//field[@name='currency_id']" position="after">
                    <field name="purchase_order" string="Purchase Order#"/>
                    <field name="origin" string="Sale Order#" groups="base.group_user" attrs="{'invisible': [('origin', '=', False)]}"/>
                </xpath>
                <xpath expr="//form/sheet/notebook/page[@name='other_info']/group/group[1]/field[@name='name']"
                       position="replace">
                    <field name="memo"/>
                </xpath>
            </field>
        </record>
        <record id="invoice_supplier_form_ex" model="ir.ui.view">
            <field name="name">account.invoice.supplier.form_ex</field>
            <field name="model">account.invoice</field>
            <field name="inherit_id" ref="account.invoice_supplier_form"/>
            <field name="arch" type="xml">
                <field name="origin" position="replace">
                    <field name="origin" string="Purchase Order#" attrs="{'invisible': [('origin', '=', False)]}"/>
                    <field name="name" string="Sale Order#"/>
                </field>
                <!--remove field-->
                <xpath expr="/form/sheet[1]/notebook/page[@name='other_info']/group/group[1]/field[@name='name']"
                       position="replace"/>
                <xpath expr="/form/sheet[1]/notebook/page[@name='other_info']/group/group[1]/field[@name='date']"
                       position="after">
                    <field name="memo"/>
                </xpath>
            </field>
        </record>
        <record id="view_order_form_cstm" model="ir.ui.view">
            <field name="name">sale.order.form.cstm</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <!--remove field-->
                <xpath expr="//field[@name='client_order_ref']" position="replace"/>
                <xpath expr="//field[@name='carrier_acc_no']" position="after">
                    <field name="client_order_ref"/>
                </xpath>
            </field>
        </record>

        <record id="view_order_list_cstm" model="ir.ui.view">
            <field name="name">sale.order.list.cstm</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_tree"/>
            <field name="arch" type="xml">
            <xpath expr="//field[@name='user_id']" position="after">
                <field name="is_share"/>
                <field name="sale_margine"/>
            </xpath>
            </field>
        </record>

        <record id="view_order_quotation_tree_cstm" model="ir.ui.view">
            <field name="name">sale.order.quotation.tree.cstm</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_quotation_tree"/>
            <field name="arch" type="xml">
            <xpath expr="//field[@name='user_id']" position="after">
                 <field name="is_share"/>
                <field name="sale_margine"/>
            </xpath>
            </field>
        </record>

        <record id="view_order_form_inherit_sale_stock" model="ir.ui.view">
            <field name="name">sale.order.form.sale.stock</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='order_line']/form/group/group/div/field[@name='product_uom']" position="replace">
                    <field name="product_uom" groups="product.group_uom" class="oe_inline oe_no_button" domain="[()]"
                                                    attrs="{'readonly': [('state', 'in', ('sale','done', 'cancel'))]}" options="{'no_create_edit': True, 'no_open': True}"/>
                </xpath>
            </field>
        </record>

        <!-- Adding Sales Level & Is_shared field into group by-->
        <record id="view_sales_order_filter_inherit" model="ir.ui.view">
            <field name="name">sale.order.common.search.inherit</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_sales_order_filter"/>
            <field name="arch" type="xml">
		    <xpath expr="/search/group" position="after">
		        <filter name="sales_level" string="Sales Level" domain="[]" context="{'group_by':'sale_margine'}"/>
                <filter name="is_shared" string="Is Shared" domain="[]" context="{'group_by':'is_share'}"/>
		    </xpath>
            </field>
        </record>

    </data>

    <template id="inherit_report_saleorder_document" inherit_id="sale.report_saleorder_document">

        <xpath expr="//h2" position="before">
            <br/>
        </xpath>

        <xpath expr="//div[@id='informations']" position="replace">
            <div class="row mt32 ml8 mb32" id="informations">

                <div t-if="doc.client_order_ref" class="mr8 ml8">
                    <strong>Your Reference:</strong>
                    <p t-field="doc.client_order_ref"/>
                </div>

                <div t-if="doc.confirmation_date and doc.state not in ['draft','sent']"  class="mr8 ml8">
                    <strong>Date Ordered:</strong>
                    <p t-field="doc.confirmation_date"/>
                </div>
                <div t-if="doc.date_order and doc.state in ['draft','sent']" class="mr8 ml8">
                    <strong>Quotation Date:</strong>
                    <p t-field="doc.date_order"/>
                </div>
                <div t-if="doc.user_id.name" class="mr8 ml8">
                    <strong>Salesperson:</strong>
                    <p t-field="doc.user_id"/>
                </div>
                <div t-if="doc.partner_id.gl_account.name" class="mr8 ml8">
                    <strong>GL Account:</strong>
                    <p t-field="doc.partner_id.gl_account.name"/>
                </div>
                <div name="payment_term" t-if="doc.payment_term_id" class="mr8 ml8">
                    <strong>Payment Terms:</strong>
                    <p t-field="doc.payment_term_id"/>
                </div>
                <div t-if="doc.validity_date and doc.state in ['draft', 'sent']" class="mr8 ml8">
                    <strong>Expiration Date:</strong>
                    <p t-field="doc.validity_date"/>
                </div>
                <div t-if="doc.carrier_track_ref" class="mr8 ml8">
                    <strong>Tracking Reference:</strong>
                    <p t-field="doc.carrier_track_ref"/>
                </div>
                <div t-if="doc.carrier_id " class="mr8 ml8">
                    <strong>Delivery Method:</strong>
                    <p t-field="doc.carrier_id.name"/>
                </div>
            </div>
        </xpath>

        <xpath expr="//table[@class='table table-sm o_main_table']" position="replace">
            <table class="table table-condensed">
                    <thead>
                        <tr>
                            <th>Description</th>
                            <th>Requisition No</th>
                            <th class="text-right">Quantity</th>
                            <th class="text-right">Unit Price</th>
                            <th t-if="display_discount" class="text-right" groups="sale.group_discount_per_so_line">Disc.(%)</th>
                            <th class="text-right">Taxes</th>
                            <th class="text-right" >Amount</th>
                            <th class="text-right price_tax_included" >Total Price</th>
                        </tr>
                   </thead>
                    <tbody class="sale_tbody">
                         <t t-set="current_subtotal" t-value="0"/>
                         <t t-foreach="doc.order_line" t-as="line">
                             <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                             <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>

                             <tr t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''" style="page-break-inside: avoid">
                                <t t-if="not line.display_type">
                                    <td><span t-field="line.name"/></td>
                                    <td><span t-field="line.req_no"/></td>
                                    <td class="text-right">
                                        <span t-field="line.product_uom_qty"/>
                                        <span t-field="line.product_uom" groups="product.group_uom"/>
                                    </td>
                                    <td class="text-right">
                                        <span t-field="line.price_unit"/>
                                    </td>
                                    <td t-if="display_discount" class="text-right" groups="sale.group_discount_per_so_line">
                                        <span t-field="line.discount"/>
                                    </td>
                                    <td class="text-right">
                                        <span t-esc="', '.join(map(lambda x: (x.description or x.name), line.tax_id))"/>
                                    </td>
                                    <td class="text-right">
                                        <span t-field="line.price_subtotal"
                                            t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                    </td>
                                    <td class="text-right" >
                                        <span t-field="line.price_total"
                                            t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                    </td>
                                    <span t-field="line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                </t>
                                <t t-if="line.display_type == 'line_section'">
                                    <td colspan="99">
                                        <span t-field="line.name"/>
                                    </td>
                                    <t t-set="current_section" t-value="line"/>
                                    <t t-set="current_subtotal" t-value="0"/>
                                </t>
                                <t t-if="line.display_type == 'line_note'">
                                    <td colspan="99">
                                        <span t-field="line.name"/>
                                    </td>
                                </t>
                            </tr>

                             <t t-if="current_section and (line_last or doc.order_line[line_index+1].display_type == 'line_section')">
                                    <tr class="is-subtotal text-right">
                                        <td colspan="99">
                                            <strong class="mr16">Subtotal</strong>
                                            <span
                                                t-esc="current_subtotal"
                                                t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'
                                            />
                                        </td>
                                    </tr>
                                </t>
                         </t>
                    </tbody>
            </table>
        </xpath>
    </template>

</odoo>
