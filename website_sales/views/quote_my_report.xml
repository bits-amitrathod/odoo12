<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="assets_frontend" inherit_id="website.assets_frontend" name="Shop">
            <xpath expr="." position="inside">
                <script type="text/javascript" src="/website_sales/static/src/js/quote_my_report.js"></script>
            </xpath>
        </template>

        <template id="quote_my_report" name="Quote My Report">
            <t t-call="website.layout">
                <section id="quote" class="report">
                        <div class="text-center pt32 pb32">
                            <h1  class="about-header"> My In-Stock Report </h1>
                        </div>
                <div class="container oe_website_sale py-2">
                    <div t-if="invalid_url and invalid_url != ''" class="js_cart_lines alert alert-info">
                        <t t-esc="invalid_url" />
                    </div>
                    <div t-elif="not bool(product_list)" class="js_cart_lines alert alert-info">
                        Products not available!
                    </div>
                    <table class="mb16 table table-striped table-sm js_cart_lines remove-odd" id="quote_products" t-if="bool(product_list)">
                    <thead>
                        <tr>
                            <th class="text-center td-checkbox">
                                <input type="checkbox" id="selectAll"/>

                            </th>
                            <th class="td-img">Product</th>
                            <th></th>
                            <th class="text-center td-manufacturer">Manufacturer</th>
                            <th class="text-center td-min-exp">Min Exp. Date</th>
                            <th class="text-center td-max-exp">Max Exp. Date</th>
                            <th class="text-center td-av-qty">Available Quantity</th>
                            <th class="text-center td-qty">Quantity</th>
                            <th class="text-center td-price">Price</th>
                            <!--<th class="text-center td-action"></th>-->
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="product_list" t-as="product">
                            <tr t-attf-id="row_checked_{{product_list.get(product)[0]['partn_name']}}" t-att-class="'optional_product info' ">
                                <td class="text-center td-checkbox align-middle">
                                    <input type="checkbox" id="product_list.get(product)[0]['product'].id"
                                           t-att-data-partn-name-id="product_list.get(product)[0]['partn_name']"
                                           t-att-data-product-id="product_list.get(product)[0]['product'].id"
                                           t-att-data-available-qty="product_list.get(product)[0]['product'].actual_quantity"/>
                                </td>
                                <td colspan="2" t-if="not product_list.get(product)[0]['product'].product_tmpl_id" class='td-img align-middle'></td>
                                <td align="center" t-if="product_list.get(product)[0]['product'].product_tmpl_id" class='td-img align-middle'>
                                    <span t-esc="product_list.get(product)[0]['product'].image_small" t-options="{'widget': 'image', 'class': 'rounded'}" />
                                </td>
                                <td t-if="product_list.get(product)[0]['product'].product_tmpl_id" class='td-product_name align-middle'>
                                    <div>
                                        <t t-call="website_sales.cart_line_product_link">
                                            <span t-esc="product_list.get(product)[0]['product'].product_tmpl_id.name"/>
                                        </t>
                                    </div>
                                </td>
                                <td class="text-center td-manufacturer align-middle">
                                    <div>
                                        <span t-esc="product_list.get(product)[0]['product_brand_name']"/>
                                    </div>
                                </td>
                                <td class="text-center td-min-exp align-middle">
                                    <div>
                                        <span t-esc="product_list.get(product)[0]['min_expiration_date']" t-options="{'widget': 'date'}"/>
                                    </div>
                                </td>
                                <td class="text-center td-max-exp align-middle">
                                    <div>
                                        <span t-esc="product_list.get(product)[0]['max_expiration_date']" t-options="{'widget': 'date'}"/>
                                    </div>
                                </td>
                                <td class="text-center td-av-qty align-middle">
                                    <div>
                                        <span t-esc="product_list.get(product)[0]['product'].actual_quantity"/>
                                    </div>
                                </td>
                                <td class="text-center td-qty align-middle">
                                    <div class="css_quantity input-group oe_website_spinner m-auto">
                                        <div class="input-group-prepend">
                                        <a t-attf-id="allow_qty_minus_{{product_list.get(product)[0]['partn_name']}}" aria-label="Remove one" title="Remove one" t-attf-href="#"
                                             style="color:#cacaca;pointer-events:none;" class="btn btn-link js_add_cart_json d-none d-md-inline-block">
                                            <i class="fa fa-minus"></i>
                                        </a>
                            </div>
                                        <input t-attf-id="input_qty_{{product_list.get(product)[0]['partn_name']}}"
                                               type="text" class="js_quantity form-control quantity"
                                               t-att-data-product-id="product_list.get(product)[0]['product'].id"
                                               t-att-data-partn-name-id="product_list.get(product)[0]['partn_name']"
                                               t-att-data-available-qty="product_list.get(product)[0]['product'].actual_quantity"
                                               t-att-value="product_list.get(product)[0]['quantity']" readonly="True"
                                               />

                        <div class="input-group-append">
                                        <a t-attf-id="allow_qty_plus_{{product_list.get(product)[0]['partn_name']}}" aria-label="Add one" title="Add one" t-attf-href="#"
                                            style="color:#cacaca;pointer-events:none;" class="btn btn-link float_left js_add_cart_json d-none d-md-inline-block">
                                            <i class="fa fa-plus"></i>
                                        </a>
                                </div>
                                    </div>
                                </td>
                                <td class="text-center td-price align-middle" name="price">
                                    <span t-esc="product_list.get(product)[0]['price_list']" style="white-space: nowrap;" t-options="{'widget': 'monetary', 'display_currency': product_list.get(product)[0]['product'].product_tmpl_id.company_id.currency_id}" />
                                </td>
                                <!--<td>
                                    &lt;!&ndash;<input type="hidden" t-att-data-product-id="product.product.id"&ndash;&gt;
                                                         &lt;!&ndash;t-att-data-partner-id="product.partner.id" t-att-value="product.product.id"/>&ndash;&gt;
                                    <a href='#' aria-label="Remove" title="Remove" class='delete_product'> <large><i class='fa fa-trash-o'></i></large></a>
                                </td>-->
                            </tr>
                        </t>
                    </tbody>
                </table>
                    <div t-if="bool(product_list)">
                        <form t-attf-action="/add/product/cart" method="POST">
                            <button type="submit" disabled="true" id="add_product_in_to_cart"
                                    title="Select at least one product" style="float: right; margin-bottom: 10px;"
                                    class="btn btn-primary btn-lg mt8 js_check_product a-submit">Add to Cart</button>
                        </form>
                    </div>
                </div>
            </section>
            </t>
        </template>

        <template id="my_in_stock_report_link" name="Link to frontend portal" inherit_id="portal.frontend_layout">
            <xpath expr="//a[@id='o_logout']" position="before">
                <a href="/shop/my_in_stock_report" role="menuitem" class="dropdown-item">My In-Stock Report</a>
            </xpath>
        </template>

        <template id="cart_line_product_link" name="Shopping Cart Line Product Link">
            <a t-attf-href="/shop/product/#{ slug(product_list.get(product)[0]['product'].product_tmpl_id) }">
                <t t-raw="0"/>
            </a>
        </template>

        <template id="add_new_column" inherit_id="website_sale.cart_lines">
            <xpath expr="//th[@class='text-center td-qty']" position="before">
                <th class="text-center td-available-qty">Available Quantity</th>
            </xpath>
            <xpath expr="//td[@class='text-center td-qty']" position="before">
                <td t-if="line.product_id.actual_quantity" class="text-center td-available-qty">
                    <div>
                        <strong t-field="line.product_id.actual_quantity" />
                    </div>
                </td>
            </xpath>
        </template>

        <template id="continue_shopping_button_custom" inherit_id="website_sale.cart">
            <xpath expr="//div/a[@class='btn btn-secondary mb32 d-none d-xl-inline-block']" position="replace">
                <a t-if="request.params.get('flag')" role="button" t-att-href="'/shop/quote_my_report/%s' % request.params.get('partner')" class="btn btn-secondary mb32 d-none d-xl-inline-block">
                                        <span class="fa fa-chevron-left" />
                                        <span class="">Continue Shopping</span>
                </a>
                <a t-else="" role="button" href="/shop" class="btn btn-secondary mb32 d-none d-xl-inline-block">
                                        <span class="fa fa-chevron-left" />
                                        <span class="">Continue Shopping</span>
                </a>
            </xpath>
        </template>
    </data>
</odoo>