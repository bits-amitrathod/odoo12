<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

                        <!-- FORM VIEW -->
        <record model="ir.ui.view" id="sps_theme.noti_form">
            <field name="name">websiteCSTM form</field>
            <field name="model">sps_theme.product_instock_notify</field>
            <field name="arch" type="xml">
                <form string="Website Notification">
                    <sheet>
                        <group>
                            <group>
                                <field name="email"/>
                                <field name="product_tmpl_id" string="Product"/>
                            </group>
                            <group>
                                <field name="x_studio_reoccuring" ></field>
                                <field name="is_new" invisible="1"/>
                                <field name="status" readonly="1"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>

        </record>


        <!-- Menu -->

        <record id="action_product_instock_notification" model="ir.actions.act_window">
            <field name="name">Product In-stock Notification</field>
            <field name="res_model">sps_theme.product_instock_notify</field>
            <field name="view_mode">tree,form</field>
             <field name="view_ids" eval="[(5, 0, 0),
        (0, 0, {'view_mode': 'tree', 'view_id': ref('sps_theme.list')},),
        (0, 0, {'view_mode': 'form', 'view_id': ref('sps_theme.noti_form')})
        ]"/>
            <field name="context">{'default_is_new': True}</field>
        </record>

        <menuitem id="menu_product_instock_notification" name="Website Product Notification"
                  action="action_product_instock_notification"
                  parent="stock.menu_stock_warehouse_mgmt" sequence="10"/>

        <!-- LIST VIEW -->
        <record model="ir.ui.view" id="sps_theme.list">
            <field name="name">websiteCSTM list</field>
            <field name="model">sps_theme.product_instock_notify</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="email"/>
                    <field name="product_tmpl_id" string="Product"/>
                    <field name="status"/>
                    <field name="is_new" invisible="1" />
                </tree>
            </field>
        </record>


        <!-- Email template -->
        <record id="mail_template_product_instock_notification_email" model="mail.template">
            <field name="name">eCommerce: Product Availability Email</field>
            <field name="model_id" ref="website_sale.model_product_template"/>
            <field name="email_from">{{ object.company_id.name if object.company_id.name else user.company_id.name }}</field>
            <field name="email_to">{{ ctx['email'] }}</field>
            <field name="subject">Your product is available</field>
            <field name="body_html" type="html">
                <t t-set="products"  t-value="ctx.get('products', [])"/>
                <div style="margin:auto;width:100%;background-color: #f6f6f6;  padding-left: 60px;">
                    <img src="/sps_theme/static/src/images/logo.png" style="height: auto; width: 80px; margin-top:30px;" t-attr-alt="user.company_id.name"/>
                    <br/>
                    <br/>
                    <p>Your item is back in stock! Click on the product below to complete your purchase.</p>
                    <table width="100%">
                        <t t-foreach="products" t-as="product">
                            <tr>
                                <td style="width:50px;padding-top: 16px;"></td>
                                <td valign="top">
                                    <a t-attf-href="/shop/product/{{product.product_tmpl_id.id}}" target="_blank">
                                        <t t-out="product.product_tmpl_id.product_variant_id.name"/>
                                    </a>
                                </td>
                            </tr>
                        </t>
                    </table>
                    <br/>
                    <br/>
                    <center style="padding-bottom: 60px;">
                        <p>
                            <b>Thank you for shopping with <t t-out="user.company_id.name"/>!</b>
                        </p>
                    </center>
                </div>
            </field>
        </record>



        <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Email Notification Template ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
        <record id="website_order_placed_mail_template" model="mail.template">
            <field name="name">Email Notification: Online Product Purchase Details</field>
            <field name="model_id" ref="website_sale.model_sale_order"/>
            <field name="email_to">{{ object.user_id.login }}</field>
            <field name="email_cc">{{ 'info@surgicalproductsolutions.com' }}</field>
            <field name="subject">Please find the sales order that was placed online at shopsps.com</field>
            <field name="body_html" type="html">
                <link href="css/bootstrap.min.css" rel="stylesheet"/>
                <div style="margin:auto;width:100%;" class="container">
                    <div style="margin-top: 50px;">
                        <div>
                           <p>Hi Team</p>
                           <p>Please find below a listing of orders that have been placed online:</p>
                        </div>
                        <center>

                        </center>
                    </div>
                    <br/>
                    <table width="80%" class="table  table-condensed  table-bordered " style="margin:auto">
                        <thead style='background-color:#D6DBDF;'>
                            <tr>
                                 <th style="text-align: center;">Sales No</th>
                                 <th style="text-align: center;">SKU</th>
                                 <th style="text-align: center;">Product Name</th>
                                 <th style="text-align: center;">Quantity</th>
                                  <th style="text-align: center;">UOM</th>
                                 <th style="text-align: center;">Unit Price</th>
                                 <th style="text-align: center;">Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                         <t t-foreach="object.order_line" t-as="product">
                              <tr>
                                <td align="center"><t t-out="product.order_id.name"/></td>
                                <t t-if="product.product_id.product_tmpl_id.default_code == False">
                                    <td></td>
                                </t>
                                <t t-else="">
                                    <td align="center">
                                        <t t-out="product.product_id.product_tmpl_id.default_code"/>
                                    </td>
                                </t>
                                <td align="center">
                                    <t t-out="product.name"/>
                                </td>
                                <td align="center">
                                    <t t-out="'%.0f' % product.product_uom_qty"/>
                                </td>
                                <td align="center">
                                    <t t-out="product.product_uom.name"/>
                                </td>
                                <td align="center">
                                    <t t-out="product.price_unit"/>
                                </td>
                                <td align="center">
                                    <t t-out="product.price_subtotal"/>
                                </td>
                              </tr>
                        </t>
                        </tbody>
                    </table>
                 </div>
                  <div  style="margin-top:20px">
                    <p>Thanks &amp; Regards,</p>
                    <p> SPS Team </p>
                  </div>
            </field>
        </record>

         <!-- CRON -->
        <record id="product_in_stock_notification" model="ir.cron">
            <field name="name">Mail: Website Product Notification</field>
            <field name="model_id" ref="model_sps_theme_product_instock_notify"/>
            <field name="state">code</field>
            <field name="code">model.send_email_product_instock()</field>
            <field name='interval_number'>15</field>
            <field name='interval_type'>minutes</field>
            <field name="numbercall">-1</field>
        </record>



    </data>
</odoo>