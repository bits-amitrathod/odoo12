<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <template id="so_quotation_content_inherit" inherit_id="sale.sale_order_portal_content" name="SPS Quotation Content inherit">
            <xpath expr="//div[@id='introduction']" position="replace">
                 <div id="introduction" t-attf-class="d-flex pb-2 pt-3 #{'card-header bg-white' if report_type == 'html' else ''} ">
                     <h2 class="my-0 mr16">
                         <span t-field="sale_order.type_name"></span>
                         <em t-esc="sale_order.name"/>
                     </h2>
                     <h3 class="m-0">
                         <span t-if="sale_order.state == 'sent'" class="badge bg-info">
                            <i class="fa fa-paper-plane-o"/>
                            Quotation Sent
                         </span>
                         <span t-if="sale_order.state == 'cancel'" class="badge bg-secondary ">
                            <i class="fa fa-fw fa-remove"/>
                            Cancelled
                         </span>
                         <span t-if="sale_order.state == 'done'" class="badge bg-success">
                             <i class="fa fa-fw fa-check"/>
                             Done
                         </span>
                         <t t-if="sale_order.team_id.team_type in ('engine', 'rapid_quote')">
                            <img src="/website_quote_ext/static/src/img/stockhawk_logo_2.jpg" align="right" style="height: auto; width: 150px;" alt="Stockhawk"/>
                         </t>
                     </h3>
                </div>
            </xpath>

            <xpath expr="//div[2]/div" position="inside">
                <div>
                    <strong t-if="sale_order.partner_id.gl_account">GL Account:</strong>
                    <div t-if="sale_order.partner_id.gl_account">
                        <t t-foreach="sale_order.partner_id.gl_account" t-as="gl_account">
                            <p t-field="gl_account.name"/>
                        </t>
                    </div>
                </div>
            </xpath>
        </template>

        <template id="sale_order_portal_content_inherit_sale_stock" name="Orders Shipping Followup" inherit_id="sale.sale_order_portal_content">
            <xpath expr="//div[@id='so_date']" position="after">
                <div class="row" t-if="sale_order.incoterm">
                    <div class="mb-3 col-6 ml-auto">
                        <strong>Incoterm: </strong> <span t-field="sale_order.incoterm"/>
                    </div>
                </div>
            </xpath>
            <xpath expr="//div[@id='informations']" position="replace">
                <div id="informations">
                    <div t-if="sale_order.transaction_ids and not invoices and sale_order.state in ('sent', 'sale') and portal_confirmation == 'pay' and not success and not error" t-att-data-order-id="sale_order.id">
                        <t t-if="sale_order.transaction_ids">
                            <t t-call="payment.payment_confirmation_status">
                                <t t-set="payment_tx_id" t-value="sale_order.get_portal_last_transaction()"/>
                                <t t-set="reference" t-value="sale_order.reference"/>
                            </t>
                        </t>
                    </div>
                    <div class="row">
                        <div class="mb-3 col-6">
                            <strong>Customer:</strong> <span t-field="sale_order.partner_id.name"/>
                        </div>
                    </div>
                    <div class="row" id="so_date">
                        <div class="mb-3 col-6">
                          <t t-if="sale_order.state in ['sale', 'done', 'cancel']">
                            <strong>Order Date:</strong>
                          </t>
                          <t t-else="">
                             <strong>Quotation Date:</strong>
                          </t>
                          <span t-field="sale_order.date_order" t-options='{"widget": "date"}'/>
                        </div>
                        <div class="mb-3 col-6" t-if="sale_order.validity_date">
                            <strong>Expiration Date:</strong> <span t-field="sale_order.validity_date" t-options='{"widget": "date"}'/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6">
                            <strong t-if="sale_order.partner_shipping_id == sale_order.partner_invoice_id" class="d-block mb-1">Invoicing and Shipping Address:</strong>
                            <strong t-if="sale_order.partner_shipping_id != sale_order.partner_invoice_id" class="d-block mb-1">Invoicing Address:</strong>
                            <address t-field="sale_order.partner_invoice_id" t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}'/>
                        </div>
                         <t t-if="sale_order.partner_shipping_id != sale_order.partner_invoice_id">
                            <div id="shipping_address" class="col-lg-6">
                                <strong class="d-block mb-1">Shipping Address:</strong>
                                <address t-field="sale_order.partner_shipping_id" t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}'/>
                            </div>
                        </t>
                    </div>

                    <t t-set="invoices" t-value="[i for i in sale_order.invoice_ids if i.state not in ['draft', 'cancel']]"/>
                    <div t-if="invoices" class="row">
                        <div class="col">
                            <strong class="d-block mb-1">Invoices</strong>
                            <ul class="list-group mb-4">
                                <t t-foreach="invoices" t-as="i">
                                    <t t-set="report_url" t-value="i.get_portal_url(report_type='pdf', download=True)"/>
                                    <div class="d-flex flex-wrap align-items-center justify-content-between">
                                        <div>
                                            <a t-att-href="report_url">
                                                <span t-esc="i.name"/>
                                            </a>
                                            <div class="small d-lg-inline-block">Date: <span class="text-muted" t-field="i.invoice_date"/></div>
                                        </div>
                                        <span t-if="i.payment_state in ('paid', 'in_payment')" class="small badge badge-success orders_label_text_align"><i class="fa fa-fw fa-check"/> <b>Paid</b></span>
                                        <span t-else="" class="small badge badge-info orders_label_text_align"><i class="fa fa-fw fa-clock-o"/> <b>Waiting Payment</b></span>
                                    </div>
                                </t>
                            </ul>
                        </div>
                    </div>
                </div>

                <t t-if="sale_order.picking_ids">
                    <div>
                        <strong>Delivery Orders</strong>
                    </div>
                    <div>
                        <t t-foreach="sale_order.picking_ids.filtered(lambda picking: picking.picking_type_id.code != 'internal')" t-as="i">
                            <t t-set="delivery_report_url" t-value="'/my/picking/pdf/%s?%s' % (i.id, keep_query())"/>
                            <div class="d-flex flex-wrap align-items-center justify-content-between o_sale_stock_picking">
                                <div>
                                    <a t-att-href="delivery_report_url">
                                        <span t-esc="i.name"/>
                                    </a>
                                    <div class="small d-lg-inline-block ml-3">Date:
                                        <span class="text-muted" t-field="i.date_done" t-options="{'date_only': True}"/>
                                        <span t-if="i.state in ['draft', 'waiting', 'confirmed', 'assigned']" class="text-muted" t-field="i.scheduled_date" t-options="{'date_only': True}"/>
                                    </div>
                                </div>
                                <span t-if="i.state == 'done'" class="small badge badge-success orders_label_text_align"><i class="fa fa-fw fa-truck"/> <b>Shipped</b></span>
                                <!--<span t-if="i.state == 'cancel'" class="small badge badge-danger orders_label_text_align"><i class="fa fa-fw fa-times"/> <b>Cancelled</b></span>-->
                                <span t-if="i.state in ['draft', 'waiting', 'confirmed', 'assigned']" class="small badge badge-info orders_label_text_align"><i class="fa fa-fw fa-clock-o"/> <b>Preparation</b></span>
                            </div>
                        </t>
                    </div>
                </t>
            </xpath>
        </template>

<!--    Override of accept and reject button-->
        <template id="so_modify_content" inherit_id="sale.sale_order_portal_template" name="Modify Content">
            <xpath expr="//div[hasclass('justify-content-center')]" position="replace">
                 <div class="text-right hidden-print mt16 mb16" id="quotation_toolbar" t-if="sale_order.state in ('draft', 'sent', 'waiting_date')">
                      <a class="btn stockhawk_reject_btn" data-bs-toggle="modal" data-bs-target="#modaldecline">
                          Reject
                      </a>
                      <a class="btn stockhawk_accept_btn" data-bs-toggle="modal" data-bs-target="#modalaccept">
                          Accept
                      </a>
                      <a t-if="sale_order.team_id.team_type in ('engine', 'rapid_quote')"
                         class="text-right btn stockhawk_update_qty_btn"
                         t-att-href="'/my/orders/edit/%s' % (sale_order.id)">
                           <b>Edit Order</b>
                      </a>
                 </div>
            </xpath>

            <xpath expr="//div[@id='modalaccept']" position="replace">

                <!-- modal relative to the actions sign and pay -->
                <div role="dialog" class="modal fade" id="modalaccept">
                    <div class="modal-dialog">
                        <form id="accept" method="POST" t-att-data-order-id="sale_order.id"
                              t-attf-action="/my/orders/#{sale_order.id}/accepts?access_token=#{sale_order.access_token}"
                              class="js_accept_json modal-content js_website_submit_form">
                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                            <input type="hidden" name="order_id" t-att-value="sale_order.id"/>
                            <header class="modal-header">
                                <h4 class="modal-title">Accept Order</h4>
                                 <t t-if="sale_order.team_id.team_type in ('engine', 'rapid_quote')">
                                    <img src="/website_quote_ext/static/src/img/stockhawk_logo_2.jpg" align="right" style="height: auto; width: 150px;" alt="Stockhawk"/>
                                </t>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </header>
                            <main class="modal-body" id="sign-dialog">
                                <t t-if="sale_order.partner_id.allow_purchase">
                                    <div>
                                       Purchase Order #:
                                       <input type="text" class="form-control"
                                                       name="client_order_ref"
                                                       t-att-value="client_order_ref"/>
                                        <lable id="client_order_ref_error" class="text-danger"/>
                                    </div>
                                </t>
                                 <p>
                                   Your Order will be shipped Ground unless otherwise stated. If expedited shipping is needed, Please indicate below:
                                    (First Overnight by 8:30AM / Priority Overnight by 10:30AM /2nd day AM by 10:30 AM /2nd Day /3rd Day)
                                </p>
                                <textarea rows="4" name="accept_message" placeholder="Your feedback....."
                                          class="form-control"/>

                                <div class="modal-footer">
                                    <button type="submit" t-object="order" id="client_order_ref_accept" class="btn stockhawk_accept_btn">Accept</button>
                                    <button type="button" class="btn stockhawk_cancel_btn" data-bs-dismiss="modal">Cancel</button>
                                </div>
                            </main>
                        </form>
                    </div>
                </div>
                <div t-if="sale_order.state == 'sale'" class="alert alert-success alert-dismissible d-print-none" role="status">
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    <strong>     This order has been validated. Thanks for your trust
                        and do not hesitate to</strong> <a role="button" href="#discussion"><i class="fa fa-comment"/> Contact us</a><strong> for any question.</strong>
                </div>

            </xpath>
            <xpath expr="//div[@id='modaldecline']" position="replace">
                <!-- modal relative to the action reject -->
                <div role="dialog" class="modal fade" id="modaldecline">
                    <div class="modal-dialog">
                        <form id="decline" method="POST"
                              t-attf-action="/my/orders/#{sale_order.id}/decline?access_token=#{sale_order.access_token}"
                              class="modal-content js_website_submit_form">
                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                            <header class="modal-header">
                                <h4 class="modal-title">Reject</h4>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </header>
                            <div class="modal-body">
                                <p>
                                    Tell us why you are refusing this quotation, this will help us improve our
                                    services.
                                </p>
                                <textarea rows="4" name="decline_message" placeholder="Your feedback....."
                                          class="form-control"/>
                            </div>
                            <footer class="modal-footer">
                                <div class="modal-footer">
                                    <button type="submit" t-object="order" class="btn stockhawk_reject_btn">Reject</button>
                                    <button type="button" class="btn stockhawk_cancel_btn" data-bs-dismiss="modal">Cancel</button>
                                </div>
                            </footer>
                        </form>
                    </div>
                </div>
            </xpath>
            <xpath expr="//li[hasclass('navspy')]" position="replace" />

            <xpath expr="//li[@t-if='sale_order.user_id']" position="replace">
                <li t-if="sale_order.order_processor" class="list-group-item flex-grow-1">
                   <div class="small mb-1"><strong class="text-muted">Your Contact</strong></div>
                   <div class="row flex-nowrap">
                       <div class="col flex-grow-0 pr-2">
                           <img class="rounded-circle mr4 float-left o_portal_contact_img" t-if="sale_order.order_processor.image_1024" t-att-src="image_data_uri(sale_order.order_processor.image_1024)" alt="Contact"/>
                           <img class="rounded-circle mr4 float-left o_portal_contact_img" t-if="not sale_order.order_processor.image_1024" src="/web/static/src/img/placeholder.png" alt="Contact"/>
                       </div>
                       <div class="col pl-0" style="min-width: 150px">
                           <span t-field="sale_order.order_processor" t-options='{"widget": "contact", "fields": ["name", "phone"], "no_marker": True}'/>
                           <a href="#discussion" class="small"><i class="fa fa-comment"></i> Send message</a>
                       </div>
                   </div>
                </li>
            </xpath>

            <xpath expr="//div[@id='quote_content']" position="attributes">
                <attribute name="class">col-12 col-lg justify-content-end stockhawk-quotation-div-inline-grid</attribute>
            </xpath>

        </template>

        <template id="pricing_inherit" inherit_id="sale.sale_order_portal_content" name="prioritization price">
          <xpath expr="//section[@id='details']" position="replace">
             <section id="details" style="page-break-inside: auto; position:relative;" class="mt32">
                 <style type="text/css">
                    .update-qty{position: absolute;top: 0;right: 0;}
                    .click-here{position: relative; top: 9px;}
                    .btn-update{
                    margin-left: 10px;}

                    @media (min-width: 768px) and (max-width: 1024px) {

                    h1
                    {
                    font-size:28px;

                    }
                    .update-qty {
                    position: absolute;
                    top: -10px;
                    right: 0;
                    }
                    .btn-update{
                    margin-left: 10px;}
                    }

                    @media(max-width: 767px) {
                    .click-here {
                    position: absolute;
                    top: 0px;
                    right: 140px;
                    }
                    .action-btn{margin: 10px 50px auto;}
                    .txt-cen{text-align:center;}
                    h1
                    {
                    font-size:30px;
                    line-height: 1.5;
                    }
                    .update-qty{position: relative !important;top: 0;right: 0;}
                    address{    word-break: break-all;}
                    .btn-update{    float: right;
                    margin-top: -15px;}
                    }
                    @media(max-width: 375px) {
                    h1
                    {
                    font-size:24px;
                    line-height: 1.5;
                    }
                    }

                </style>
                <div>
                    <h2 class="page-header" style="padding-top: 0px">Pricing</h2>
                    <h5 class="update-qty" t-if="sale_order.state in ['sent'] and sale_order.team_id.team_type in ('engine', 'rapid_quote')"><a class="btn stockhawk_update_qty_btn" t-att-href="'/my/orders/edit/%s' % (sale_order.id)">
                        <b>Edit Order</b>
                        </a>
                    </h5>
                </div>
                <t t-set="display_discount" t-value="True in [line.discount > 0 for line in sale_order.order_line]"/>
                <div class="table-responsive">
                    <table class="table table-sm" id="sales_order_table">
                        <thead class="bg-100">
                            <tr>
                                <!-- TODO: remove in master -->
                                <t t-set="colspan" t-value="6"/>
                                <th class="text-left"><span t-if="any([line.order_id.team_id.team_type=='engine' for line in sale_order.order_line])">Ref #</span></th>
                                <th class="text-left">Description</th>
                                <th class="text-left">Available Qty</th>
                                <th class="text-center td-min-exp" style="width: 100px;">Min Exp. Date</th>
                                <th class="text-center td-max-exp" style="width: 100px;">Max Exp. Date</th>
    <!--                            <th class="text-left"><span t-if="any([line.order_id.team_id.team_type=='engine' for line in sale_order.order_line])">Expiration</span></th>-->
                                <th class="text-left"><span t-if="any([line.order_id.team_id.team_type in ('engine', 'rapid_quote') for line in sale_order.order_line])">Selected Expiration</span></th>
                                <th><span t-if="any([line.req_date for line in sale_order.order_line])">Requisition Date</span></th>
                                <th><span t-if="any([line.req_no for line in sale_order.order_line])">Requisition No</span></th>
                                <th><span t-if="any([line.vendor for line in sale_order.order_line])">Vendor</span></th>
                                <th><span t-if="any([line.item_no for line in sale_order.order_line])">Item No.</span></th>
                                <th><span t-if="any([line.deliver_to_location for line in sale_order.order_line])">Deliver-to Location</span></th>
                                <th class="text-right">Reserved Quantity</th>
                                <th t-attf-class="text-right {{ '' if report_type == 'html' else '' }}">Unit Price</th>
                                <th t-if="display_discount" t-attf-class="text-right {{ '' if report_type == 'html' else '' }}">
                                    <span>Discount</span>
                                    <!-- TODO: remove in master -->
                                    <t t-set="colspan" t-value="colspan+1"/>
                                </th>
                                <th style="display: none;" t-attf-class="text-right {{ '' if report_type == 'html' else '' }}">Taxes</th>
                                <th class="text-right" >
                                    <span groups="account.group_show_line_subtotals_tax_excluded">Amount</span>
                                    <span groups="account.group_show_line_subtotals_tax_included">Total Price</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody class="sale_tbody">
                            <t t-set="current_subtotal" t-value="0"/>
                            <t t-foreach="sale_order.order_line" t-as="line">
                                <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>

                                <tr t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                                    <t t-if="not line.display_type">
                                        <td id="product_sku_code"><span t-if="line.order_id.team_id.team_type=='engine'" t-field="line.product_id.product_tmpl_id.sku_code"/> </td>
                                        <td id="product_name"><span t-field="line.name"/> </td>
                                        <td class="text-right" id="product_name"><span t-field="line.product_id.product_tmpl_id.actual_quantity"/></td>
    <!--                                    <td id="product_name"><span t-if="line.order_id.team_id.team_type=='engine' and line.product_min_max_exp_date" t-field="line.product_min_max_exp_date"/> </td>-->
                                        <td class="text-right"><div><span t-esc="line.product_id.min_exp_date" t-options="{'widget': 'date'}"/></div></td>
                                        <td class="text-right"><div><span t-esc="line.product_id.max_exp_date" t-options="{'widget': 'date'}"/></div></td>
                                        <td id="product_name"><span t-if="line.order_id.team_id.team_type in ('engine', 'rapid_quote') and line.product_min_max_exp_date" t-field="line.product_min_max_exp_date"/> </td>
                                        <td><span t-if="line.req_date" t-field="line.req_date" t-options='{"widget": "date"}'/></td>
                                        <td><span t-if="line.req_no" t-field="line.req_no"/></td>
                                        <td><span t-if="line.vendor" t-field="line.vendor"/></td>
                                        <td><span t-if="line.item_no" t-field="line.item_no"/></td>
                                        <td><span t-if="line.deliver_to_location" t-field="line.deliver_to_location"/></td>
                                        <td class="text-right">
                                            <div id="quote_qty">
                                                <span t-field="line.product_uom_qty"/>
                                                <span t-field="line.product_uom" groups="uom.group_uom"/>
                                            </div>
                                        </td>
                                        <td t-attf-class="text-right {{ '' if report_type == 'html' else '' }}">
                                            <div
                                                t-if="line.discount &gt;= 0"
                                                t-field="line.price_unit"
                                                t-att-style="line.discount and 'text-decoration: line-through' or None"
                                                t-att-class="(line.discount and 'text-danger' or '') + ' text-right'"
                                            />
                                            <div t-if="line.discount">
                                                <t t-esc="(1-line.discount / 100.0) * line.price_unit" t-options='{"widget": "float", "decimal_precision": "Product Price"}'/>
                                            </div>
                                        </td>
                                        <td t-if="display_discount" t-attf-class="text-right {{ 'd-none d-sm-table-cell' if report_type == 'html' else '' }}">
                                            <strong t-if="line.discount &gt; 0" class="text-info">
                                                <t t-esc="((line.discount % 1) and '%s' or '%d') % line.discount"/>% discount
                                            </strong>
                                        </td>
                                        <td style="display: none;" t-attf-class="text-right {{ '' if report_type == 'html' else '' }}">
                                            <span t-esc="', '.join(map(lambda x: (x.description or x.name), line.tax_id))"/>
                                        </td>
                                        <td class="text-right">
                                            <span class="oe_order_line_price_subtotal" t-field="line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                            <span class="oe_order_line_price_total" t-field="line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                        </td>
                                    </t>
                                    <t t-if="line.display_type == 'line_section'">
                                        <td colspan="99">
                                            <span t-field="line.name"/>
                                        </td>
                                        <t t-set="current_section" t-value="line"/>
                                        <t t-set="current_subtotal" t-value="0"/>
                                    </t>
                                    <t t-if="line.display_type == 'line_note'">
                                        <td colspan="99">
                                            <span t-field="line.name"/>
                                        </td>
                                    </t>
                                </tr>

                                <t t-if="current_section and (line_last or sale_order.order_line[line_index+1].display_type == 'line_section')">
                                    <tr class="is-subtotal text-right">
                                        <td colspan="99">
                                            <strong class="mr16">Subtotal</strong>
                                            <span
                                                t-esc="current_subtotal"
                                                t-options='{"widget": "monetary", "display_currency": sale_order.pricelist_id.currency_id}'
                                            />
                                        </td>
                                    </tr>
                                </t>
                            </t>
                        </tbody>
                    </table>
                </div>

                <div id="total" class="row" name="total" style="page-break-inside: avoid;">
                    <div t-attf-class="#{'col-4' if report_type != 'html' else 'col-sm-7 col-md-5'} ml-auto">
                        <table class="table table-sm">
                            <tr class="border-black" style="border-bottom:1px solid #dddddd;">
                                <td><strong>Subtotal</strong></td>
                                <td class="text-right">
                                    <span
                                        data-id="total_untaxed"
                                        t-field="sale_order.amount_untaxed"
                                        t-options='{"widget": "monetary","display_currency": sale_order.pricelist_id.currency_id}'
                                    />
                                </td>
                            </tr>
                            <!--TODO: UPD ODOO16 Need TO  Check amount_by_group field -->
                            <!--<t t-foreach="sale_order.amount_by_group" t-as="amount_by_group">
                                <tr style="border-bottom:1px solid #dddddd;">
                                    <t t-if="amount_by_group[3] == 1 and sale_order.amount_untaxed == amount_by_group[2]">
                                        <td>
                                            <span t-esc="amount_by_group[0]"/>
                                            <span>&amp;nbsp;<span>on</span>&amp;nbsp;<t t-esc="amount_by_group[2]" t-options='{"widget": "monetary", "display_currency": sale_order.pricelist_id.currency_id}'/></span>
                                        </td>
                                        <td class="text-right">
                                            <span t-esc="amount_by_group[1]"
                                                t-options='{"widget": "monetary", "display_currency": sale_order.pricelist_id.currency_id}'/>
                                        </td>
                                    </t>
                                    <t t-else ="">
                                        <td>
                                            <span t-esc="amount_by_group[0]"/>
                                        </td>
                                        <td class="text-right">
                                            <span t-esc="amount_by_group[1]"
                                                t-options='{"widget": "monetary", "display_currency": sale_order.pricelist_id.currency_id}'/>
                                        </td>
                                    </t>
                                </tr>
                            </t>-->
                            <tr class="border-black">
                                <td><strong>Total</strong></td>
                                <td class="text-right">
                                    <span data-id="total_amount" t-field="sale_order.amount_total" t-options='{"widget": "monetary", "display_currency": sale_order.pricelist_id.currency_id}'/>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </section>
          </xpath>
        </template>

        <template id="portal_order_page_ex" name="Sales Order">
            <t t-call="portal.portal_layout">
                <t t-set="invoices" t-value="[i for i in sale_order.invoice_ids if i.state not in ['draft', 'cancel']]"/>
                <t t-set="invoices_amount" t-value="sum(i.amount_total for i in invoices)"/>
                <div id="optional_placeholder"></div>
                <div class="container">
                    <style type="text/css">
                        input.quantity {
                        padding: 14px 8px;
                        width: 53px !important;
                        display: inline;
                        margin-bottom: 1em;
                        }
                        @media (min-width: 768px) and (max-width: 1024px) {}
                        @media(max-width: 767px){.action-btn{    margin: 10px auto;
                        display: block;
                       }input.quantity {
                        width: 50px !important;}
                        @media(max-width: 375px){.action-btn {    margin: 10px auto;
                        display: block;
                        text-align: center; }}

                    </style>
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <div class="row">
                                 <div class="col-md-6 col-xs-12 col-sm-6">
                                    <div id="introduction">
                                         <h2 class="my-0">
                                             <span t-field="sale_order.type_name"></span>
                                             <em t-esc="sale_order.name"/>
                                             <span class="txt-cen">
                                                 <t t-if="sale_order.state == 'cancel'">
                                                     <span style="font-size:1rem;vertical-align: top;" class="badge bg-secondary">
                                                         <i class="fa fa-fw fa-remove"/>
                                                         Cancelled
                                                     </span>
                                                 </t>
                                                 <t t-if="sale_order.state == 'done'">
                                                     <span style="font-size:1rem;vertical-align: top;" class="badge bg-success">
                                                         <i class="fa fa-fw fa-check"/>
                                                         Done
                                                     </span>
                                                 </t>
                                             </span>
                                         </h2>
                                    </div>
                                </div>
                                <div class="text-right col-md-6 col-sm-6 col-xs-12 hidden-print" id="o_portal_order_actions">
                                 <div class="action-btn">
                                    <t t-if="sale_order.amount_total != 0">
                                      <t t-set="report_url" t-value="sale_order.get_portal_url(report_type='pdf', download=True)"/>
                                      <a t-att-href="report_url">
                                        <i class="fa fa-download mr-1" role="img" aria-label="Download" title="Download"/> Download
                                      </a>
                                    </t>

                                    <a class="btn stockhawk_reject_btn ml8 " data-bs-toggle="modal" data-bs-target="#decline">
                                        Reject
                                    </a>
                                    <t t-if="sale_order.amount_total != 0">
                                        <a class="btn stockhawk_accept_btn ml8 " data-bs-toggle="modal" data-bs-target="#accept">
                                            Accept
                                        </a>
                                    </t>
                                 </div>
                               </div>
                            </div>
                        </div>
                        <div class="panel-body engine">
                            <t t-if="error or warning" t-call="sale.portal_order_error"/>
                            <t t-if="success and (not error and not warning)" t-call="sale.portal_order_success"/>
                            <div class="mb8">
                                <strong>Date:</strong>
                                <span t-field="sale_order.create_date" t-options='{"widget": "date"}'/>
                                <t t-if="sale_order.team_id.team_type in ('engine', 'rapid_quote')">
                                   <img src="/website_quote_ext/static/src/img/stockhawk_logo_2.jpg" align="right" style="height: auto; width: 150px;" alt="Stockhawk"/>
                                </t>
                            </div>
                            <div class="mb8" t-if="sale_order.validity_date">
                                <strong>Expiration Date:</strong>
                                <span t-field="sale_order.validity_date" t-options='{"widget": "date"}'/>
                            </div>

                            <div class='row'>
                                <div class="col-md-6">
                                    <div>
                                        <strong>Invoicing Address</strong>
                                    </div>
                                    <div>
                                        <address t-field="sale_order.partner_invoice_id"
                                                 t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}'/>
                                    </div>
                                    <t t-if="invoices">
                                        <div>
                                            <strong>Invoices</strong>
                                        </div>
                                        <div>
                                            <t t-foreach="invoices" t-as="i">
                                                <t t-set="report_url"
                                                   t-value="'/my/invoices/pdf/%s?%s' % (i.id, 'access_token=%s' % i.access_token if access_token else '')"/>
                                                <div>
                                                    <a t-att-href="report_url">
                                                        <span class="fa fa-download"/>
                                                    </a>
                                                    <a t-att-href="report_url">
                                                        <span t-esc="i.number"/>
                                                    </a>
                                                    <span class="text-muted" t-field="i.date_invoice"/>
                                                    <t t-if="i.state == 'paid'">
                                                        <span class="badge bg-success orders_label_text_align">
                                                            <i class="fa fa-fw fa-check"/>
                                                            Paid
                                                        </span>
                                                    </t>
                                                    <t t-if="i.state != 'paid'">
                                                        <span class="badge bg-info orders_label_text_align">
                                                            <i class="fa fa-fw fa-clock-o"/>
                                                            Waiting
                                                        </span>
                                                    </t>
                                                </div>
                                            </t>
                                        </div>
                                    </t>
                                </div>
                                <div id="shipping_address" class="col-md-6"
                                     groups="sale.group_delivery_invoice_address">
                                    <div>
                                        <strong>Shipping Address</strong>
                                    </div>
                                    <div>
                                        <address t-field="sale_order.partner_shipping_id"
                                                 t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}'/>
                                    </div>
                                </div>
                            </div>

                          <div class="row">
                                <div class="col-md-12 table-responsive">
                                <table class="table">
                                    <tr>
                                        <!--<th></th>-->
                                        <th><span t-if="any([line.order_id.team_id.team_type=='engine' for line in sale_order.order_line])">Ref #</span> </th>
                                        <th><span>Description</span> </th>
                                        <th class="text-left">Available Qty</th>
<!--                                                <th><span t-if="any([line.order_id.team_id.team_type=='engine' for line in sale_order.order_line])">Expiration</span> </th>-->
                                        <th><span t-if="any([line.order_id.team_id.team_type in ('engine', 'rapid_quote') for line in sale_order.order_line])">Selected Expiration</span> </th>
                                        <th><span t-if="any([line.req_date for line in sale_order.order_line])">Requisition Date</span></th>
                                        <th><span t-if="any([line.req_no for line in sale_order.order_line])">Requisition No</span></th>
                                        <th><span t-if="any([line.vendor for line in sale_order.order_line])">Vendor</span></th>
                                        <th><span t-if="any([line.item_no for line in sale_order.order_line])">Item No.</span></th>
                                        <th><span t-if="any([line.deliver_to_location for line in sale_order.order_line])">Deliver-to Location</span></th>
                                        <th><span>Unit Price</span> </th>
                                        <th><span>Reserved Quantity</span></th>
                                        <th><span>Subtotal</span></th>
                                        <th></th>
                                    </tr>
                                 <t t-foreach="sale_order.order_line" t-as="ol">
                                 <tr>
                                    <t t-if="ol.product_uom_qty != 0">
                                        <td>
                                            <span t-if="ol.order_id.team_id.team_type=='engine'" t-esc="ol.product_id.product_tmpl_id.sku_code"/>
                                        </td>
                                        <td>
                                            <span t-esc="ol.product_id.name"/>
                                        </td>
                                        <td class="text-left" id="product_name"><span t-field="ol.product_id.product_tmpl_id.actual_quantity"/></td>
<!--                                        <td><span t-if="ol.order_id.team_id.team_type=='engine' and ol.product_min_max_exp_date" t-esc="ol.product_min_max_exp_date"/></td>-->
                                        <td><span t-if="ol.order_id.team_id.team_type in ('engine', 'rapid_quote') and ol.product_min_max_exp_date" t-esc="ol.product_min_max_exp_date"/></td>
                                        <td><span t-if="ol.req_date" t-field="ol.req_date" t-options='{"widget": "date"}'/></td>
                                        <td><span t-if="ol.req_no" t-field="ol.req_no"/></td>
                                        <td><span t-if="ol.vendor" t-field="ol.vendor"/></td>
                                        <td><span t-if="ol.item_no" t-field="ol.item_no"/></td>
                                        <td><span t-if="ol.deliver_to_location" t-field="ol.deliver_to_location"/></td>
                                        <td>
                                            <span t-field="ol.price_unit"
                                          t-options='{"widget": "monetary", "display_currency": sale_order.pricelist_id.currency_id}'/>
                                        </td>
                                        <t t-if="ol._name == 'sale.order.line'">
                                            <t t-if="sale_order.state == 'sent'">
                                                <td>
                                                    <div class="css_quantity input-group oe_website_spinner d-flex align-items-center">
                                                        <a title="Decrease Quality" t-attf-href="#" style="background-color: #FFFFFF;border: 0px;color: #3d9cca!important;margin-bottom: 0px!important;"
                                                           class="mb8 input-group-addon js_add_cart_json btn">
                                                            <i class="fa fa-minus"></i>
                                                        </a>
                                                        <input type="text" class="js_quantity form-control quantity m-0"
                                                               t-att-data-quote-id="ol.order_id.id"
                                                               t-att-data-line-id="ol.id"
                                                               t-att-data-product-id="ol.product_id.id"
                                                               t-att-value="ol.product_uom_qty" readonly="True" style="
                                                                 background-color: white;"/>
                                                        <a style="cursor: not-allowed;background-color: #FFFFFF;border: 0px;margin-bottom: 0px!important; margin-left: auto;    margin-left: auto;"
                                                           class="mb8 input-group-addon float_left js_add_cart_json btn">
                                                            <i class="fa fa-plus" style="readonly:true;color: #cacaca;"></i>
                                                        </a>
                                                    </div>
                                                </td>
                                            </t>
                                            <t t-if="sale_order.state != 'sent'">
                                                <td>
                                                    <span t-esc="ol.product_uom_qty"/>
                                                </td>
                                            </t>
                                        </t>
                                        <td>
                                            <span t-field="ol.price_subtotal"
                                                  t-options='{"widget": "monetary", "display_currency": sale_order.pricelist_id.currency_id}'/>
                                            <input type="hidden" class="change js_quantity form-control quantity"
                                                               t-att-data-quote-id="ol.order_id.id"
                                                               t-att-data-line-id="ol.id"
                                                               t-att-data-product-id="ol.product_id.id"
                                                               t-att-value="ol.product_uom_qty"/>
                                            <span>  </span>
                                        </td>
                                        <td>
                                            <a href='#' title="Remove" class='js_delete_product no-decoration'> <large>  <i class='fa fa-trash-o' style="margin-left: 5px;font-size: 16px;"></i></large></a>
                                        </td>
                                    </t>
                                 </tr>
                            </t>
                        </table>
                      </div>
                    </div>
                    <hr/>

                    <div class="row">
                        <div class="col-md-6">
                            <div>
                                <div>
                                    <strong>Contact</strong>
                                </div>
                                <div t-field="sale_order.user_id.partner_id"
                                     t-options='{"widget": "contact", "fields": ["email", "phone"]}'/>
                                <br/>
                            </div>
                            <div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="row mb4">
                                <div class="col-md-9 col-xs-8 text-right">
                                    <strong>Subtotal</strong>
                                </div>
                                <div class="col-md-3 col-xs-4 text-right">
                                    <strong>
                                        <span t-field="sale_order.amount_untaxed"
                                              t-options='{"widget": "monetary", "display_currency": sale_order.pricelist_id.currency_id}'/>
                                    </strong>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-9 col-xs-8 text-right">
                                    <strong>Total</strong>
                                </div>
                                <div class="col-md-3 col-xs-4 text-right">
                                    <strong>
                                        <span t-field="sale_order.amount_total"
                                              t-options='{"widget": "monetary", "display_currency": sale_order.pricelist_id.currency_id}'/>
                                    </strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                        <div class="panel-heading  text-right hidden-print mt16 mb16" id="portal_sign" style="margin-bottom: 0px !important">
                            <a class="btn stockhawk_update_qty_btn" onclick="history.back()" data-bs-target="#discussion">
                                <i class="fa fa-comments-o"></i>
                                Feedback
                            </a>
                            <a class="btn stockhawk_reject_btn" data-bs-toggle="modal" data-bs-target="#decline">
                                Reject
                            </a>
                             <t t-if="sale_order.amount_total != 0">
                            <a class="btn stockhawk_accept_btn" data-bs-toggle="modal" data-bs-target="#accept">
                                Accept
                            </a>
                             </t>
                        </div>

                        <div class="modal" id="accept" role="dialog" aria-hidden="true">
                            <div class="modal-dialog">
			                    <form id="accept" method="POST" t-attf-action="/my/orders/#{sale_order.id}/accepts?access_token=#{sale_order.access_token}" class="modal-content">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    <input type="hidden" name="order_id" t-att-value="sale_order.id"/>
                                    <div class="modal-header">
                                        <h4 class="modal-title">Accept Order</h4>
                                        <t t-if="sale_order.team_id.team_type in ('engine', 'rapid_quote')">
                                            <img src="/website_quote_ext/static/src/img/stockhawk_logo_2.jpg" align="right" style="height: auto; width: 150px;" alt="Stockhawk"/>
                                        </t>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-hidden="true"></button>
                                    </div>
                                     <t t-if="sale_order.partner_id.allow_purchase">
                                            <div class="modal-body">
                                               Purchase Order #:
                                               <input type="text" class="form-control"
                                                               name="client_order_ref"
                                                               t-att-value="client_order_ref"/>
                                                <lable id="client_order_ref_error" class="text-danger"/>
                                            </div>
                                      </t>
                                    <div class="modal-body">
                                        <p>
                                           Your Order will be shipped Ground unless otherwise stated. If expedited shipping is needed, Please indicate below:
                                            (First Overnight by 8:30AM / Priority Overnight by 10:30AM /2nd day AM by 10:30 AM /2nd Day /3rd Day)
                                        </p>
                                        <textarea rows="4" name="accept_message" placeholder="Your feedback....."
                                                  class="form-control"/>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="submit" t-object="order" id="client_order_ref_accept" class="btn stockhawk_accept_btn">Accept</button>
                                        <button type="button" class="btn stockhawk_cancel_btn" data-bs-dismiss="modal">Cancel</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="modal" id="decline" role="dialog" aria-hidden="true">
                            <div class="modal-dialog">
                                <form id="decline" method="POST" t-attf-action="/my/orders/#{sale_order.id}/declines?access_token=#{sale_order.access_token}" class="modal-content">
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    <div class="modal-header">
                                        <h4 class="modal-title">Reject</h4>
                                        <t t-if="sale_order.team_id.team_type in ('engine', 'rapid_quote')">
                                            <img src="/website_quote_ext/static/src/img/stockhawk_logo_2.jpg" align="right" style="height: auto; width: 150px;" alt="Stockhawk"/>
                                        </t>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-hidden="true"></button>
                                    </div>
                                    <div class="modal-body">
                                        <p>
                                            Tell us why you are refusing this quotation, this will help us improve our
                                            services.
                                        </p>
                                        <textarea rows="4" name="decline_message" placeholder="Your feedback....."
                                                  class="form-control"/>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="submit" t-object="order" class="btn stockhawk_reject_btn">Reject</button>
                                        <button type="button" class="btn stockhawk_cancel_btn" data-bs-dismiss="modal">Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="oe_structure mb32"/>
            </t>
        </template>

        <template id="portal_my_purchase_orders_offer" inherit_id="purchase.portal_my_purchase_orders" name="Purchase">
            <xpath expr="//t[@t-call='portal.portal_table']" position="replace">
                <t t-if="orders" t-call="portal.portal_table">
                    <thead>
                        <tr class="active">
                            <th>Purchase Orders #</th>
                            <th>Order Date</th>
                            <th>Offer Type</th>
                            <th></th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="orders" t-as="order">
                            <tr>
                                <td><a t-attf-href="/my/purchase/#{order.id}?#{keep_query()}"><t t-esc="order.name"/></a></td>
                                <td><span t-field="order.date_order"/></td>
                                <td><span t-field="order.offer_type"/> <span t-if="((not order.offer_type) or order.offer_type=='False' ) and order.vendor_offer_data == True ">Cash/Credit </span> </td>
                                <td>
                                    <t t-if="order.invoice_status == 'to invoice'">
                                        <span class="badge badge-info"><i class="fa fa-fw fa-file-text"/> Waiting for Bill</span>
                                    </t>
                                    <t t-if="order.state == 'cancel'">
                                        <span class="badge badge-secondary"><i class="fa fa-fw fa-remove"/> Cancelled</span>
                                    </t>
                                </td>
                                <td><span t-field="order.amount_total" t-options='{"widget": "monetary", "display_currency": order.currency_id}'/></td>
                            </tr>
                        </t>
                    </tbody>
               </t>
          </xpath>
         </template>

        <template id="portal_my_purchase_order_offer" inherit_id="purchase.portal_my_purchase_order" name="Sps Portal Purchase orders">
            <xpath expr="//t[@t-call='portal.portal_layout']" position="replace">
                <t t-call="portal.portal_layout">
                    <t t-set="purchase_order" t-value="order"/>
                    <div id="optional_placeholder"></div>
                    <div class="container">
                      <div class="card">
                        <div class="card-header">
                          <div class="row">
                            <div class="col-lg-12">
                              <h4 >
                                <t t-if="order.state in ['draft', 'sent']">
                                  Request for Quotation
                                </t>
                                <t t-else="1">
                                  Purchase Order
                                </t>
                                <span t-esc="order.name"/>
                              </h4>
                            </div>
                          </div>
                        </div>
                        <div class="card-body">
                          <div class="mb8">
                              <strong>Date:</strong> <span t-field="order.date_order" t-options='{"widget": "date"}'/>
                          </div>
                             <div class="mb8">
                              <strong>Offer type:</strong> <span t-field="order.offer_type"/> <span t-if="((not order.offer_type) or order.offer_type=='False' ) and order.vendor_offer_data == True">Cash/Credit</span>
                          </div>
                          <div class="row">
                            <div class="col-lg-6">
                              <strong>Product</strong>
                            </div>
                            <div class="col-lg-2 text-right">
                              <strong>Unit Price</strong>
                            </div>
                            <div class="col-lg-2 text-right">
                              <strong>Quantity</strong>
                            </div>
                            <div class="col-lg-2 text-right">
                              <strong>Subtotal</strong>
                            </div>
                          </div>
                          <t t-foreach="order.order_line" t-as="ol">
                            <div class="row purchases_vertical_align">
                              <div id='product_name' class="col-lg-6">
                                <span t-esc="ol.name"/>
                              </div>
                              <div class="col-lg-2 text-right">
                                <span t-field="ol.price_unit" t-options='{"widget": "monetary", "display_currency": order.currency_id}'/>
                              </div>
                              <div class="col-lg-2 text-right">
                                  <span t-esc="ol.product_qty"/>
                              </div>
                              <div class="col-lg-2 text-right">
                                <span t-field="ol.price_subtotal" t-options='{"widget": "monetary", "display_currency": order.currency_id}'/>
                              </div>
                            </div>
                          </t>
                          <hr/>

                          <div class="row">
                            <div class="col-lg-12 text-right">
                              <div class="row">
                                <div class="col-lg-10 text-right">
                                  Untaxed Amount:
                                </div>
                                <div class="col-lg-2 text-right">
                                  <span t-field="order.amount_untaxed" t-options='{"widget": "monetary", "display_currency": order.currency_id}'/>
                                </div>
                              </div>
                              <div class="row">
                                <div class="col-lg-10 text-right">
                                  Taxes:
                                </div>
                                <div class="col-lg-2 text-right">
                                  <span t-field="order.amount_tax" t-options='{"widget": "monetary", "display_currency": order.currency_id}'/>
                                </div>
                              </div>
                              <div class="row">
                                <div class="col-lg-10 text-right">
                                  <strong>Total:</strong>
                                </div>
                                <div class="col-lg-2 text-right">
                                  <strong><span t-field="order.amount_total" t-options='{"widget": "monetary", "display_currency": order.currency_id}'/></strong>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="oe_structure mb32"/>
                </t>
            </xpath>
        </template>

    </data>
</odoo>
