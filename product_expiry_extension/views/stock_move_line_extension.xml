<?xml version="1.0" encoding="utf-8"?>
<odoo>
 <record id="view_extension_move_stock_line_operation_tree_custom" model="ir.ui.view">
    <field name="name">stock.move.line.operations.tree</field>
    <field name="model">stock.move.line</field>
    <field name="inherit_id" ref="stock.view_stock_move_line_operation_tree" />
    <field name="arch" type="xml">
        <field name="picking_id" invisible="1" force_save="1"/>
        <field name="product_id" invisible="1"/>
        <!--<field name="parent.picking_type_entire_packs" invisible="1"/>-->
        <field name="qty_done" position="replace">
              <field name="qty_done" invisible="1" />
        </field>
        <field name="lot_id" position="replace">
            <field class="min_width" name="lot_id" groups="stock.group_production_lot"
                        attrs="{'readonly': ['&amp;', ('package_level_id', '!=', False), ('parent.picking_type_entire_packs', '=', True)]}"
                        invisible="not context.get('show_lot_id_column')"
                        domain="[('product_qty', '>', 0.0), ('product_id', '=', parent.product_id), ('company_id', '=', company_id)]"
                        context="{
                            'active_picking_id': picking_id,
                            'default_company_id': parent.company_id,
                            'default_product_id': parent.product_id,
                            'lot_date_display_name': True
                        }"
                    />
            <field class="min_width" name="lot_id_po" groups="stock.group_production_lot"
                        attrs="{'readonly': ['&amp;', ('package_level_id', '!=', False), ('parent.picking_type_entire_packs', '=', True)]}"
                        invisible="not context.get('do_not_show_lot_id_column')"
                        domain="[('product_id', '=', parent.product_id), ('company_id', '=', company_id)]"
                        context="{
                            'active_picking_id': picking_id,
                            'default_company_id': parent.company_id,
                            'default_product_id': parent.product_id,
                            'lot_date_display_name': True
                        }"
                    />
        </field>
        <field name="lot_id" position="after">
            <field name="lot_use_date" attrs="{'readonly': [('lot_use_date', '!=', False)]}" invisible="not context.get('show_lot_id_column')" groups="stock.group_production_lot" context="{'default_product_id': parent.product_id, 'active_picking_id': picking_id}" />
        </field>
         <field name="lot_name"  position="after" >
              <field name="lot_expired_date" widget="inventory_purchase"  attrs="{'readonly': [('parent.picking_type_entire_packs', '=', True)]}"  invisible="not context.get('show_lots_text')" groups="stock.group_production_lot"/>
              <field name="qty_done" attrs="{'readonly': ['|', '&amp;', ('state', '=', 'done'), ('is_locked', '=', True), ('parent.picking_type_entire_packs', '=', True)]}"/>
         </field>
        <field name="location_id" position="replace">
            <field name="location_id" attrs="{'readonly': [('parent.picking_type_entire_packs', '=', True)]}" domain="[('id', 'child_of', parent.location_id)]" groups="stock.group_stock_multi_locations" invisible="1"/>
        </field>
        <field name="result_package_id" position="replace">
            <field name="result_package_id" attrs="{'readonly': [('parent.picking_type_entire_packs', '=', True)]}" groups="stock.group_tracking_lot" domain="['|', '|', ('location_id', '=', False), ('location_id', '=', location_dest_id), ('id', '=', package_id)]" invisible="1"/>
        </field>
    </field>
</record>

<record id="view_stock_move_line_operation_tree_expiry" model="ir.ui.view">
        <field name="name">stock.move.line.inherit.tree</field>
        <field name="model">stock.move.line</field>
        <field name="inherit_id" ref="stock.view_stock_move_line_operation_tree"/>
        <field name="arch" type="xml">
             <xpath expr="//field[@name='expiration_date']" position="replace" >
                <field name="picking_type_use_existing_lots" invisible="1"/>
                <field name="expiration_date" force_save="1"  attrs="{
                    'column_invisible': ['|', ('parent.use_expiration_date', '!=', True), ('parent.picking_code', '!=', 'incoming')],
                       'readonly': 0,
                }"/>
            </xpath>
        </field>
    </record>

<!--          <record id="view_extension_move_stock_line_operation_detailed_op" model="ir.ui.view">-->
<!--                <field name="name">stock.move.line.inherit.new.lotid</field>-->
<!--                <field name="model">stock.move.line</field>-->
<!--                <field name="inherit_id" ref="stock.view_stock_move_line_detailed_operation_tree"/>-->
<!--                <field name="arch" type="xml">-->

<!--                        <field name="lot_id" position="replace">-->
<!--                            <field  name="lot_id" groups="stock.group_production_lot"-->
<!--                                   attrs="{'column_invisible': [('parent.show_lots_text', '=', True)],-->
<!--                                   'invisible': [('lots_visible', '=', False)]}"-->
<!--                                   context="{'default_product_id': product_id, 'default_company_id':-->
<!--                                   company_id, 'active_picking_id': picking_id , 'lot_date_display_name': True }" optional="show"/>-->


<!--                    </field>-->
<!--                      <field name="lot_id" position="after">-->
<!--                    <field name="lot_use_date" attrs="{'readonly': [('lot_use_date', '!=', False)]}"  groups="stock.group_production_lot"-->
<!--                         string="Lot Expiration Date"  context="{'default_product_id': parent.product_id, 'active_picking_id': picking_id}" />-->
<!--            </field>-->
<!--                </field>-->
<!--                </record>-->

</odoo>